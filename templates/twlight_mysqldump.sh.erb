#!/usr/bin/env bash

PATH=/usr/local/bin:/usr/bin:/bin:/sbin:$PATH

twlight_mysqldumpdir=<%= @twlight_mysqldumpdir %>
twlight_mysqlhost=localhost
twlight_mysqldb=twlight
twlight_mysqluser=twlight
twlight_mysqlpass=$(cat <%= @twlight_root_dir %>/TWLight/settings/local_vars.py | grep ^MYSQL_PASSWORD | cut -d "=" -f 2 | xargs)

echo "Dumping TWLight database"

## Perform sql-dump
bash -c "mysqldump -h '${twlight_mysqlhost}' -u '${twlight_mysqluser}' -p'${twlight_mysqlpass}' '${twlight_mysqldb}' > '${twlight_mysqldumpdir}/twlight.sql'"

## Root only
chmod 0600 "${twlight_mysqldumpdir}/twlight.sql"

echo "Finished dumping TWLight database."
