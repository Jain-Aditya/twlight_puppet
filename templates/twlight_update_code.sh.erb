#!/usr/bin/env bash

# Make sure www owns the .git tree
chown -R www:www /var/www/html/TWLight/.git

# Pull latest git, apply changes to Django
# If that succeeds, run the test suite
# If that succeeds, restart Green Unicorn
sudo su <%= @twlight_unixname %> bash -c "\
/var/www/html/TWLight/bin/./virtualenv_update.sh >>/var/www/html/TWLight/TWLight/logs/update.log 2>&1 &&\
/var/www/html/TWLight/bin/./virtualenv_test.sh >>/var/www/html/TWLight/TWLight/logs/test.log 2>&1" &&\
systemctl restart gunicorn
